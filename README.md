# Appointment project

## Содержание

1. [Описание](#1-описание)
2. [Переменные среды](#2-переменные-среды)
3. [Эндпоинты](#3-эндпоинты)
4. [Диаграммы](#4-диаграммы)
5. [Проектирование-реализация](#5-проектирование-реализация)
6. [Telegram-bot](#6-telegram---bot-с-ии-подбором-врача)

## 1. Описание

Полноценный микросервис для записи пациентов на приём к врачам

Ниже приведён список Makefile команд. Для запуска нужно находится в папке `/server`  
и перед каждой командой прописать `make`. Например, `make up` для запуска compose'а.

| Название команды | Краткое описание                                  |
|-----------------:|:--------------------------------------------------|
|             lint | Проверка isort, black, flake8                     |
|              run | запуск dev среды (docker бд, локально api)        |
|             test | запуск тестов                                     |
|          migrate | применить миграции из папки versions              |
|          install | установить зависимости                            |
|               up | запустить compose                                 |
|             down | остановить compose                                |
|        prod_test | Проверка isort, black, flake8 в контейнере        |
|     prod_migrate | Применить миграции из папки versions в контейнере |

### Важно!

Чтобы проект прошёл все `ci` проверки, нужны
следующие [секреты репозитория](https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/using-secrets-in-github-actions)
в github actions:

## 2. Переменные среды

Переменные среды совпадают с секретами в ci

| Секрет/перменная среды | Значение по умолчанию | Краткое описание      |
|-----------------------:|:----------------------|-----------------------|
|                DB_HOST | db                    | адрес контейнера с бд |
|                DB_PORT | 5432                  | порт базы данных      |
|            POSTGRES_DB | dbname                | название базы данных  |
|          POSTGRES_USER | username              | пользователь бд       |
|      POSTGRES_PASSWORD | password              | пароль бд             |

## 3. Эндпоинты

- `POST /appointments` - создать запись;
- `GET /appointments/{id}` - получить запись по ID;

## 4. Диаграммы

Activity-диаграмма `/diagrams/activity.pdf`  
Архитектурная схема `/diagrams/architecture.pdf`  
ER-диаграмма `/diagrams/er.png`  
Документ бизнес-процесса в [Miro](https://miro.com/app/board/uXjVIgbwfjE=/?share_link_id=232645599645)


## 5. Проектирование-реализация

|               Название шага | Реализация                                     |
|----------------------------:|:-----------------------------------------------|
|  Проектирование архитектуры | Выбор микросервисной архитектуры               |
|          Проектирование API | Единый формат ошибок, RESTful стандарт         |
|           Проектирование БД | ER-диаграмма, нормализация схемы               |
|                  Реализация | compose.yml с сервисами бд и fastapi, makefile |
| Валидация проектных решений | Написание тестов                               |

## 6. Telegram - bot с ИИ-подбором врача

1. Бот спрашивает ФИО, затем номер телефона.
2. Бот предлагает 2 варианта - выбор врача, либо описать симптомы.
3. Если выбран первый вариант - бот загружает свободные даты и время приёма с пагинацией в markup
4. Если пользователь решил описать симптомы, LLM определяет специализацию и запрашивает данные из бд

В качестве ML библиотеки решил использовать `scikit-learn` с собственным датасетом. Пример находится в /model.
В symptoms.csv находится пара "описание симптома" -> "нужный врач".
Чтобы натренировать модель `python train`, чтобы предсказать `python predict`

Для создания диалоговых окон - `aiogram-dialog`   
для отслеживания истории сообщений - `aiogram.fsm` + `context`
