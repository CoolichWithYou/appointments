# Appointment project

## Содержание

1. [Описание](#1-описание)
2. [Переменные среды](#2-Переменные среды)
3. [Эндпоинты](#3-эндпоинты)
4. [Makefile](#4-makefile)
5. [Диаграммы](#5-диаграммы)
6. [Проектирование-реализация](#6-проектирование-реализация)
7. [Telegram-bot](#7-telegram---bot-с-ии-подбором-врача)

## 1. Описание

MVP микросервиса для записи пациентов. Для запуска compose сборки локально
нужно прописать

`docker compose up --build`

Переменные среды из `.env.example` автоматически подтянутся и будут использоваться как `db`,
так и `fastapi` сервером в контейнерах.

`fastapi` не запустится пока `db` не будет инициализирована полностью. За это отвечает `wait-for-db.sh`.
Т.к. `depends on` в compose файле гарантирует только ожидание запуска контейнера, а не его готовность
принимать подключения.

### Важно!

Чтобы проект прошёл все `ci` проверки, надо
следующие [секреты репозитория](https://docs.github.com/en/actions/how-tos/security-for-github-actions/security-guides/using-secrets-in-github-actions)
в github actions:

## 2. Переменные среды

| Секрет/перменная среды | Значение по умолчанию | Краткое описание      |
|-----------------------:|:----------------------|-----------------------|
|                DB_HOST | db                    | адрес контейнера с бд |
|                DB_PORT | 5432                  | порт базы данных      |
|            POSTGRES_DB | dbname                | название базы данных  |
|          POSTGRES_USER | username              | пользователь бд       |
|      POSTGRES_PASSWORD | password              | пароль бд             |

## 3. Эндпоинты

- `POST /appointments` - создать запись;
- `GET /appointments/{id}` - получить запись по ID;

## 4. Makefile

| Название команды | Краткое описание                                  |
|-----------------:|:--------------------------------------------------|
|             lint | Проверка isort, black, flake8                     |
|              run | запуск dev среды (docker бд, локально api)        |
|             test | запуск тестов                                     |
|          migrate | применить миграции из папки versions              |
|          install | установить зависимости                            |
|               up | запустить compose                                 |
|             down | остановить compose                                |
|        prod_test | Проверка isort, black, flake8 в контейнере        |
|     prod_migrate | Применить миграции из папки versions в контейнере |

## 5. Диаграммы

Архитектурная схема `/diagrams/architecture.png`  
ER-диаграмма `/diagrams/er.png`  
Activity-диаграмма `/diagrams/activity.png`  
[Документ бизнесс-процесса](https://miro.com/welcomeonboard/K2UvTFh4ZFNoYU10SERnbTJQNjJqb01IL1VNaTdLVFBvbmZxNm9rNU5sanRwR1BQeXlBRmI4YkFkNmU0NGVaTjNSeTdTdkpuZkZmNDB1MVllWGw2Yndub2NidW1pNFhoSWR4N3RaQTc0WW1NREQ2cDZLWHMrUW5Yd2VQdFVJY1FnbHpza3F6REdEcmNpNEFOMmJXWXBBPT0hdjE=?share_link_id=575849172273)

## 6. Проектирование-реализация

|               Название шага | Реализация                                     |
|----------------------------:|:-----------------------------------------------|
|  Проектирование архитектуры | Выбор микросервисной архитектуры               |
|          Проектирование API | Единый формат ошибок, RESTful стандарт         |
|           Проектирование БД | ER-диаграмма, нормализация схемы               |
|                  Реализация | compose.yml с сервисами бд и fastapi, makefile |
| Валидация проектных решений | Написание тестов                               |

## 7. Telegram - bot с ИИ-подбором врача

1. Бот спрашивает ФИО, затем номер телефона.
2. Бот предлагает 2 варианта - выбор врача, либо описать симптомы.
3. Если выбран первый вариант - бот загружает свободные даты и время приёма с пагинацией в markup
4. Если пользователь решил описать симптомы, LLM определяет специализацию и запрашивает данные из бд

В качестве ML библиотеки решил использовать `scikit-learn` с собственным датасетом. Пример находится в /model.
В symptoms.csv находится пара "описание симптома" -> "нужный врач".
Чтобы натренировать модель `python train`, чтобы предсказать `python predict`
